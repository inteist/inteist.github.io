<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"> <head> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2630485-14"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-2630485-14'); </script> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <!-- Enable responsiveness on mobile devices--> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Automated Snapshots on Digital Ocean Instead of Backups &middot; Inteist </title> <!-- CSS --> <link rel="stylesheet" href="/public/css/poole.css"> <link rel="stylesheet" href="/public/css/hyde.css"> <link href='//fonts.googleapis.com/css?family=Fjalla+One|Lato|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="canonical" href=" https://inteist.com/automated-snapshots-digital-ocean-backups/" /> <!-- Default pygments --> <link rel="stylesheet" href="/public/css/extra/pygments/monokai.css"> <!-- Icons --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png"> <link rel="shortcut icon" href="/public/favicon.ico"> <!-- RSS --> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <!-- Google Adsense Validation --> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9336216488761027" crossorigin="anonymous"></script> </head> <body> <div class="sidebar"> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1 id="site-name"> <a href="/"> Inteist </a> </h1> <p class="lead">I code for living</p> </div> <nav class="sidebar-nav"> <!-- <a class="sidebar-nav-item" href="/">Home</a> --> <a class="sidebar-nav-item" href="/pages">Pages</a> <a class="sidebar-nav-item" href="/dev-resources">Dev Resources</a> <a class="sidebar-nav-item" href="/figlet">Figlet</a> <a class="sidebar-nav-item" href="/git">Git Tips</a> <div class="sidebar-spacer">&nbsp;</div> <a class="sidebar-nav-item" href="/search">Search</a> <a class="sidebar-nav-item" href="/calendar">Posts Calendar</a> <a class="sidebar-nav-item" href="/tags">Tags</a> <a class="sidebar-nav-item" href="/archive">Archive</a> <a class="sidebar-nav-item" href="/me">Me</a> </nav> <p class="copyright">&copy; 2010 - 2023</p> </div> </div> <div class="content container"> <div class="search-bar"> <a href="/search"><img src="/public/img/search-bar-l.png" alt="Search" height="60px"></a> </div> <div class="post link-underline"> <!-- Title --> <h1 class="post-title">Automated Snapshots on Digital Ocean Instead of Backups</h1> <!-- Description --> <span class="post-date" title="249 words">~ 2 min read. Published 01 Apr 2023</span> <h2 id="what-is-doctl">What is <code class="language-html highlighter-rouge">doctl</code></h2> <p>Doctl is a command-line interface (CLI) tool for managing and interacting with DigitalOcean resources. There are several benefits to using Doctl, such as its ability to automate complex tasks and streamline workflows. With Doctl, users can easily create, configure, and delete resources such as droplets, volumes, and load balancers. Additionally, Doctl offers a simple and intuitive interface for managing clusters, deploying applications, and monitoring resources. Other benefits of using Doctl include its ability to integrate with popular DevOps tools like Terraform and Ansible, as well as its support for multiple programming languages and platforms. Overall, Doctl provides developers and system administrators with a powerful and flexible tool for managing their DigitalOcean infrastructure.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>
<span class="nv">resourceID</span><span class="o">=</span><span class="s1">'4851361'</span>

<span class="k">function </span>DO-create-snapshot<span class="o">()</span> <span class="o">{</span>
    doctl compute droplet-action snapshot <span class="nv">$resourceID</span> <span class="nt">--snapshot-name</span> <span class="s2">"subdomain.domain.com</span><span class="si">$(</span><span class="nb">date</span> +%Y-%m-%d-%H-%M-%S<span class="si">)</span><span class="s2">"</span>
<span class="o">}</span>

<span class="k">function </span>DO-delete-last-snapshot<span class="o">()</span> <span class="o">{</span>
    <span class="nv">snapshotID</span><span class="o">=</span><span class="si">$(</span>doctl compute snapshot list <span class="nt">-v</span> <span class="nt">--region</span> nyc3 | <span class="nb">awk</span> <span class="s1">'NR&gt;1'</span> | <span class="nb">sort</span> <span class="nt">-k4</span> | <span class="nb">awk</span> <span class="s1">'NR==1{print $1}'</span><span class="si">)</span>
    doctl compute snapshot <span class="nt">--interactive</span><span class="o">=</span><span class="nb">false </span>delete <span class="nv">$snapshotID</span>  <span class="nt">--force</span>      <span class="c"># non interactive variant suitable for automation</span>
<span class="o">}</span>

<span class="c"># first schedule the creation of the new snapshot and IF successful - delete oldest one</span>
<span class="nb">alias </span>DO-rotate-NYC-snapshot<span class="o">=</span><span class="s2">"DO-create-snapshot-NYC_DO_COMITIC_COM &amp;&amp; DO-delete-last-NYC3-snapshot"</span>
</code></pre></div></div> <p>of course, you can do that for many resources and name the methdos accordingly</p> <p>Hope it helps!</p> </div> <!-- TAGs LIST --> <div class="tag-links-list" style="text-align: right;"> </div> <!-- RELATED POSTS --> <div class="related"> <h3 id="similar-posts">Related Posts</h3> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> <!-- RELATED POSTS --> </div> <!-- LATEST POSTS --> <div class="related"> <h3 id="latest-posts">Latest Posts</h3> <ul class="related-posts"> <li> <h4> <a href="/hammerspoon-key-map-key-names/"> Hammerspoon Key Map (Key Names) </a> &nbsp;&nbsp;<small>13 May 2023</small> </h4> </li> <li> <h4> <a href="/vscode-vertical-rulers-setup/"> VSCode vertical rulers setup </a> &nbsp;&nbsp;<small>25 Apr 2023</small> </h4> </li> <li> <h4> <a href="/automated-snapshots-digital-ocean-backups/"> Automated Snapshots on Digital Ocean Instead of Backups </a> &nbsp;&nbsp;<small>01 Apr 2023</small> </h4> </li> <li> <h4> <a href="/derived-data-deletion-useful-commands/"> DerivedData Deletion - Useful Commands </a> &nbsp;&nbsp;<small>26 Mar 2023</small> </h4> </li> </ul> </div> <div id="disqus_thread"></div> <script type="text/javascript"> /* * * CONFIGURATION VARIABLES * * */ var disqus_shortname = 'inteist'; /* * * DON'T EDIT BELOW THIS LINE * * */ (function () { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> </div> </body> </html>
